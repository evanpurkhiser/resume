---
import type {Experience} from '../types';
import {formatDateRange, formatDateRangeShort} from '../utils/dates';
import ItemCard from './ItemCard.astro';
import {marked} from 'marked';

interface Props {
  experience: Experience;
}

const {experience} = Astro.props;
const dateRange = formatDateRange(experience.dates.start, experience.dates.end);
const dateRangeShort = formatDateRangeShort(experience.dates.start, experience.dates.end);

// Configure marked to render inline markdown (no wrapping <p> tags)
marked.use({
  mangle: false,
  headerIds: false,
});
---

<ItemCard title={experience.company} subtitle={experience.title}>
  <div slot="trailing" class="text-xs sm:text-sm text-slate-500 dark:text-stone-400">
    <span class="sm:hidden" aria-label={dateRange}>{dateRangeShort}</span>
    <span class="hidden sm:inline" aria-hidden="true">{dateRange}</span>
  </div>
  {experience.description && <p class="prose-text">{experience.description}</p>}

  {
    experience.sections.map(section => (
      <section class="flex flex-col gap-1">
        {section.heading && (
          <h4 class="text-sm text-slate-500 dark:text-stone-400">{section.heading}</h4>
        )}
        <ul class="flex flex-col gap-2">
          {section.bullets.map(bullet => (
            <li class="experience-bullet" set:html={marked.parseInline(bullet)} />
          ))}
        </ul>
      </section>
    ))
  }
</ItemCard>
