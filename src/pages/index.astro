---
import '../styles/global.css';
import {readFileSync} from 'fs';
import {load} from 'js-yaml';
import {join} from 'path';
import type {Resume} from '../types';
import AreaHeading from '../components/AreaHeading.astro';
import ExperienceItem from '../components/ExperienceItem.astro';
import LinkedInIcon from '../components/LinkedInIcon.astro';

const resumePath = join(process.cwd(), 'content', 'resume.yaml');
const resumeYaml = readFileSync(resumePath, 'utf8');
const resume = load(resumeYaml) as Resume;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{resume.personal.name} - Resume</title>
  </head>
  <body
    class="max-w-[8.5in] mx-auto p-8 font-['Helvetica_Neue',Helvetica,Arial,sans-serif] text-gray-900"
  >
    <main class="flex flex-col gap-6">
      <header class="flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold">{resume.personal.name}</h1>
          <p class="text-lg font-light">{resume.personal.title}</p>
        </div>
        <div class="flex flex-col items-end gap-1 text-sm">
          <ul class="flex items-center gap-2">
            <li class="flex items-center gap-2 after:content-['—'] after:text-gray-600">
              <a href={resume.personal.linkedin} class="block">
                <LinkedInIcon />
              </a>
            </li>
            <li class="flex items-center gap-2 after:content-['—'] after:text-gray-600">
              <a href={resume.personal.website} class="text-gray-900 underline"
                >{resume.personal.website.replace('https://', '')}</a
              >
            </li>
            <li class="flex items-center gap-2">
              <a href={`mailto:${resume.personal.email}`} class="text-gray-900 underline"
                >{resume.personal.email}</a
              >
            </li>
          </ul>
          {
            resume.personal.phoneLastFour && (
              <span class="text-gray-900">∗∗∗-∗∗∗-{resume.personal.phoneLastFour}</span>
            )
          }
        </div>
      </header>

      <section
        class="flex flex-row gap-4 justify-between relative before:content-[''] before:absolute before:top-0 before:left-1/2 before:-translate-x-1/2 before:w-screen before:h-px before:bg-gray-100 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:w-screen after:h-px after:bg-gray-100"
      >
        {
          resume.skills.map((skillGroup, index) => (
            <>
              <article class="flex flex-col gap-2 mt-4 mb-6">
                <AreaHeading>{skillGroup.category}</AreaHeading>
                <ul
                  class="grid gap-x-8 gap-y-1"
                  style={`grid-template-columns: repeat(${index === 1 ? 3 : 2}, max-content);`}
                >
                  {skillGroup.items.map(item => (
                    <li class="text-xs">{item}</li>
                  ))}
                </ul>
              </article>
              <div role="presentation" class="w-px bg-gray-100" />
            </>
          ))
        }
        <article class="flex flex-col gap-2 w-[240px] shrink min-w-max mt-4 mb-6">
          <AreaHeading>Education</AreaHeading>
          <div class="flex flex-col">
            <p class="text-xs font-bold mb-2">{resume.education.degree}</p>
            <p class="text-xs">{resume.education.institution}</p>
            <p class="text-xs text-gray-500">
              {new Date(resume.education.dates.start).getFullYear()} – {
                resume.education.dates.end
                  ? new Date(resume.education.dates.end).getFullYear()
                  : 'Present'
              }
            </p>
          </div>
        </article>
      </section>

      <section class="flex flex-col gap-2">
        <AreaHeading>Experiences</AreaHeading>

        <ol class="flex flex-col gap-6">
          {
            resume.experience.map(job => (
              <li>
                <ExperienceItem experience={job} />
              </li>
            ))
          }
        </ol>
      </section>

      <section class="flex flex-col gap-4">
        <AreaHeading>Personal Highlights</AreaHeading>

        {
          resume.projects.map(project => (
            <article class="flex flex-col gap-2">
              <header class="flex items-baseline justify-between">
                <h3 class="text-lg font-bold">{project.name}</h3>
                <div class="flex items-baseline gap-6">
                  {project.website && (
                    <a
                      href={project.website}
                      class="text-sm text-gray-600 hover:underline"
                    >
                      {project.website}
                    </a>
                  )}
                  {project.links &&
                    project.links.map(link => (
                      <a
                        href={link.url}
                        class="text-sm text-gray-600 hover:underline github-link"
                      >
                        {link.name}
                      </a>
                    ))}
                </div>
              </header>
              <p class="text-sm">{project.description}</p>
            </article>
          ))
        }
      </section>
    </main>
  </body>
</html>
